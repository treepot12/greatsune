<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>그레잇썬주식회사</title>
</head>
<body>
    <h1 onclick="logo()">그레잇썬주식회사</h1><p id="login" onclick="login()">로그인</p> <p id="logout" onclick="logot()">로그아웃</p>
    <ul id="postList"></ul>
    <a id="wr" href="writing.html" style="text-align: right;"><p>글쓰기</p></a>
</body>
<script type="module">
    import "./logo.js";
    import { isLoged } from "./loged.js";
    import { db } from "./app.js";
    import { getDocs, collection, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    document.getElementById("wr").addEventListener("click", (e) => {
        if (!isLoged()) {
            alert("로그인이 필요한 서비스입니다!");
            e.preventDefault();
        }
    });

    if (isLoged()){
        document.getElementById("logout").style.display = "block";
        document.getElementById("login").style.display = "none";
    }
    if (!isLoged()){
        document.getElementById("logout").style.display = "none";
        document.getElementById("login").style.display = "block";
    }

    const q = query(
        collection(db, "posts"),
        orderBy("createdAt", "desc")
    );

    const list = document.getElementById("postList");

    const snapshot = await getDocs(q);
    snapshot.forEach(doc => {
        const title = doc.data().title;
        const content = doc.data().content;
        
        const li = document.createElement("li");
        li.innerHTML = `<h3>${title}</h3><p>${content}</p>`;

        list.appendChild(li);
    });

</script>
</html>